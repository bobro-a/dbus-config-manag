# D-Bus Configuration Manager

Лёгкий фреймворк на C++/Qt для динамического применения конфигураций между приложениями через D-Bus.

Проект реализован с использованием языка C++ и библиотеки QtDBus. Для сборки используется система CMake.

## Структура проекта
- `server` — сервис, регистрирующий объекты D-Bus и отправляющий сигнал конфигурации
- `app` — клиент, подписывающийся на сигнал и применяющий изменённые сервером данные

## Ключевые классы
### server
- main.cpp - регистрирует сервер и создаёт объект ConfigurationManager с интерфейсом com.system.configurationManager
- ConfigurationManager - класс, загружающий все файлы конфигурации при запуске и создающий для каждого объект ConfigObject с интерфейсом
com.system.configurationManager.Application.{applicationName}
- ConfigObject - класс, который хранит информацию о конфигурации конкретного приложения
и генерирует сигнал `configurationChanged` если конфигурация приложения меняется.
Также данный класс предоставляет метод `GetConfiguration` для получения текущей конфигурации приложения.

### app
- main.cpp - связывает сигнал `configurationChanged` с методом обработки у приложения `newData`.
- Application - класс реализует метод `loadStartData`, который загружает стартовую конфигурацию из файла и инициирует вывод объекта `TimePhrase` в консоль по таймауту с помощью метода `printData`
Также класс содержит обработчик сигнала `configurationChanged`, реализованный через метод `newData`, который обновляет конфигурацию приложения в соответствии с указаниями сервера.
## Сборка проекта

Для сборки проекта в корневой директории необходимо выполнить запуск файла CMakeLists.txt. В дополнение к нему в проекте расположены два дополнительных файла CMakeLists.txt, отвечающие за сборку подпрограмм для клиентского приложения и сервера.

Рекомендуемый порядок действий:
1. Создайте отдельную директорию для сборки.
2. Перейдите в созданную директорию.
3. Выполните команду `cmake ..` для конфигурации сборки.
4. Выполните команду `make` для компиляции проекта.

### Зависимости
- Qt 6 с модулем DBus
- CMake ≥ 3.28
- Linux с поддержкой D-Bus session bus

## Использование
Перед запуском проекта в корневой папке добавьте папку для файлов
конфигурации (`~/com.system.configurationManager`). После этого добавьте файл конфигурации
`~/com.system.configurationManager/confManagerApplication1.json`
Пример содержания файла:
```json
{
"Timeout": 5000,
"TimeoutPhrase": "hard working!!!"
}
```
Затем, после того как собрали проект запустите в отдельном термнале сервер и запомните
сессию Dbus, чтобы подключаться к ней в других терминалах
Для запуска сервера в новой D-Bus сессии используйте:
```bash
dbus-launch
eval $(dbus-launch)
```
После сборки проекта запустите сервер в отдельной терминальной сессии и сохраните переменную окружения `DBUS_SESSION_BUS_ADDRESS`.
Затем экспортируем сессию в терминал приложения `export <DBUS_SESSION_BUS_ADDRESS>`
После этого запускаем приложение, оно начнёт выводить фразу, которая 
указана в параметре `TimeoutPhrase` файла конфигурации. Затем отправляем серверу сообщение из задания 
и фраза меняется.

 